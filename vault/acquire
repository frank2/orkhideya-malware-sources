#!/bin/bash

source orkhideya
ork_include malware
ork_include stdout
ork_include stdlib

_hash="$(echo $1 | tr '[:upper:]' '[:lower:]')"
[ -z "$_hash" ] && exit 1

! malware_sample_search vault "$_hash" && exit 2

if [ "${#_hash}" == "32" ]; then
   _searchpath="md5"
elif [ "${#_hash}" == "40" ]; then
   _searchpath="sha1"
elif [ "${#_hash}" == "64" ]; then
   _searchpath="sha256"
fi

if [ "$_searchpath" == "sha256" ]; then
   _filetype="f"
else
   _filetype="l"
fi

_sample="$(find "$(malware_vault)/$_searchpath" -type $_filetype -name $_hash | head -n1)"

if [ "$_filetype" == "l" ]; then
   _sample="$(readlink -f "$_sample")"
fi

echo "$_sample"
exit 0
