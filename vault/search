#!/bin/bash

source orkhideya
ork_include malware
ork_include stdout
ork_include stdlib

_hash="$(echo $1 | tr '[:upper:]' '[:lower:]')"
[ -z "$_hash" ] && exit 1

if [ "${#_hash}" == "32" ]; then
   _searchpath="md5"
elif [ "${#_hash}" == "40" ]; then
   _searchpath="sha1"
elif [ "${#_hash}" == "64" ]; then
   _searchpath="sha256"
else
   stdout_error "Unknown hash-type: $(stdout_color_wrap main-focused "$_hash")."
   stdout_normal "Vault search accepts md5, sha1 and sha256 sums."
   exit 2
fi

stdout_normal "Hash type: $(stdout_color_wrap main-focused "$_searchpath")."

if [ "$_searchpath" == "sha256" ]; then
   _filetype="f"
else
   _filetype="l"
fi

_results="$(find "$(malware_vault)/$_searchpath" -type $_filetype -name $_hash | head -n1)"

if [ -z "$_results" ]; then
   stdout_error "Hash $(stdout_color_wrap main-focused "$_hash") was not found."
   exit 3
fi

stdout_normal "Found $(stdout_color_wrap main-focused "$_hash")."
exit 0
